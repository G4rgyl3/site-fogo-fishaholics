<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ£ Fish Per Cast Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Single source of truth for styling -->
  <link rel="stylesheet" href="./styles.css" />

</head>

<body>
  <div class="pageGrid">
    <div class="card">
      <header>
        <h1>ğŸ£ Fish Per Cast</h1>
        <div class="subtitle">Sliders, typing, and a tiny curve.</div>
      </header>

      <div class="grid">
        <!-- Rod level -->
        <div class="control">
          <div class="control-top">
            <div class="label">Rod Level</div>
            <div class="valueBox">
              <input id="levelNum" type="number" min="1" max="60" step="1" value="10" />
              <span class="pill" id="levelHint">max 60</span>
            </div>
          </div>
          <input id="levelRange" type="range" min="1" max="60" step="1" value="10" />
        </div>

        <!-- Difficulty -->
        <div class="control">
          <div class="control-top">
            <div class="label">Difficulty</div>
            <div class="valueBox">
              <input id="diffNum" type="number" min="1" max="256000000" step="1" value="1" />
              <span class="pill" id="diffHint">min 1</span>
            </div>
          </div>
          <input id="diffRange" type="range" min="1" max="256000000" step="1" value="1" />
        </div>
      </div>

      <div class="results">
        <div class="row">
          <span>Rod Power</span>
          <span class="value" id="rodPowerOut">â€”</span>
        </div>
        <div class="row">
          <span>Catch Chance</span>
          <span class="value" id="catchChanceOut">â€”</span>
        </div>
        <div class="row">
          <span>Expected FISH / Cast</span>
          <span class="value highlight" id="fishPerCastOut">â€”</span>
        </div>
      </div>

      <div class="chartWrap">
        <div class="chartHead">
          <div class="chartTitle">Mini chart: expected FISH/cast vs level</div>
          <div class="chartMeta" id="chartMeta">Difficulty: â€”</div>
        </div>
        <canvas id="chart" width="900" height="560"></canvas>
      </div>

      <footer>Using fish.js game math</footer>
    </div>

    <!-- Durability Throughput -->
    <div class="card" id="durabilityCard">
      <header>
        <h2>ğŸ› ï¸ Durability Throughput</h2>
        <div class="subtitle">Regen rates, casts/sec, and expected output.</div>
      </header>

      <div class="grid">
        <!-- Current durability -->
        <div class="control">
          <div class="control-top">
            <div class="label">Current durability</div>
            <div class="valueBox">
              <input id="durCurNum" type="number" min="0" step="1" value="400" />
              <span class="pill" id="durCurHint">â€”</span>
            </div>
          </div>
          <input id="durCurRange" type="range" min="0" max="1000" step="1" value="400" />
        </div>

        <!-- Max durability -->
        <div class="control">
          <div class="control-top">
            <div class="label">Max durability</div>
            <div class="valueBox">
              <input id="durMaxNum" type="number" min="1" step="1" value="1000" />
              <span class="pill" id="durMaxHint">20% = â€”</span>
            </div>
          </div>
          <input id="durMaxRange" type="range" min="1" max="20000" step="1" value="1000" />
        </div>
      </div>

      <div class="results">
        <div class="row"><span>Durability regen rate</span><span class="value" id="durRegenOut">â€”</span></div>
        <div class="row"><span>Casts/sec (best: â‰¥20%)</span><span class="value" id="castsBestOut">â€”</span></div>
        <div class="row"><span>Casts/sec (below 20%)</span><span class="value" id="castsLowOut">â€”</span></div>
        <div class="row"><span>Casts available now (before &lt;20%)</span><span class="value" id="castsBefore20Out">â€”</span></div>
        <div class="row"><span>Max casts next 24h (stay â‰¥20%)</span><span class="value" id="casts24BestOut">â€”</span></div>
        <div class="row"><span>Max casts next 24h (let it drop &lt;20%)</span><span class="value" id="casts24LowOut">â€”</span></div>
        <div class="row"><span>Expected FISH / day (stay â‰¥20%)</span><span class="value highlight" id="fishDayBestOut">â€”</span></div>
        <div class="row"><span>Expected FISH / day (below 20% pace)</span><span class="value" id="fishDayLowOut">â€”</span></div>
      </div>

      <footer>Uses current â€œExpected FISH / Castâ€ from the calculator above.</footer>
    </div>

    <div class="card">
      <div class="titleRow">
        <div>
          <div class="title">ğŸ“¡ Player Stats</div>
          <div class="sub">Live on-chain state + events.</div>
        </div>
      </div>

      <div class="onchainGrid" style="grid-template-columns: 1fr; margin-top: 0;">
        <div class="control">
          <div class="control-top">
            <div class="label">On-chain sync</div>
            <span class="pill" id="chainStatus">idle</span>
          </div>
          <div class="valueBox" style="justify-content: space-between; width: 100%;">
            <input id="ownerAddr" placeholder="Owner wallet pubkey (optional)" style="width: 100%; max-width: 320px;" />
            <button id="syncChain">Load from chain</button>
          </div>
          <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top:10px; flex-wrap:wrap;">
            <div style="display:flex; gap:8px; flex-wrap:wrap;">
              <button id="setAsMe" title="Save this owner as your active player" disabled>Set as me</button>
              <button id="clearMe" title="Clear active player">Clear</button>
            </div>
            <span class="pill" id="activeMe">me: â€”</span>
          </div>
        </div>

        <div class="control">
          <div style="display:flex; align-items:center; justify-content:space-between;">
            <div class="label" style="font-size: 14px;">On-chain snapshot</div>
            <span class="pill" id="chainUpdated">â€”</span>
          </div>
          <div id="chainSnapshot" style="margin-top:10px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: 12px; line-height: 1.4;">
            <div style="opacity:0.7;">No data loaded yet.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Dedicated Player Scanner card (separate from Player Stats) -->
    <div class="card" id="playerScanCard">
      <div class="titleRow">
        <div>
          <div class="title">ğŸ§­ Player Scanner</div>
          <div class="sub">Scan all PlayerState accounts (filtered by discriminator) and show a quick leaderboard sample.</div>
        </div>
        <div style="display:flex; align-items:center; gap:10px;">
          <button id="scanPlayers">Scan players</button>
          <span class="pill" id="scanStatus">idle</span>
        </div>
      </div>

      <div class="scanBarWrap" style="margin-top: 12px;">
        <div class="scanBar" id="scanBar"></div>
      </div>
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top:10px; flex-wrap:wrap;">
        <div class="sub" id="scanCount">â€”</div>
        <div class="sub">Top unprocessed (sample)</div>
      </div>

      <ul class="clean" id="scanTop" style="margin-top:10px;"></ul>
    </div>

    <div class="card full" id="processingCard">
      <div class="titleRow">
        <div>
          <div class="title">ğŸŸ Fish Processing</div>
          <div class="sub">Detects on-chain <code>process_fish</code> and logs player + amount.</div>
        </div>
        <div style="display:flex; align-items:center; gap:10px;">
          <label class="pill" style="cursor:pointer; user-select:none;">
            <input id="procLiveToggle" type="checkbox" style="margin:0 8px 0 0; transform: translateY(1px);" checked />
            Live
          </label>
          <span class="pill" id="procStatus">startingâ€¦</span>
        </div>
      </div>

      <div class="control" style="margin-top: 12px;">
        <div class="label">Rolling log (latest first)</div>
        <ul class="clean" id="processedFeed"></ul>
      </div>
    </div>

  </div>

  <!-- Your math lives here -->
  <script src="fish.js"></script>

  <!-- Calculator UI (sliders + chart) -->
  <script src="./calc-ui.js"></script>


  <!-- On-chain logic extracted into its own module file -->
  <script type="module" src="./onchain-ui.js"></script>

  <!-- Optional: tx debugging helper (not loaded by default) -->
  <!-- <script type="module" src="./tx-debug.js"></script> -->
</body>
</html>
